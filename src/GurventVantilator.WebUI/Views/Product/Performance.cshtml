@model GurventVantilator.Application.DTOs.ProductDto

@{
    int productId = ViewBag.ProductId;
}

<link rel="stylesheet" href="~/css/performance-style.css" />


<div class="container pt-180">

    @{
        bool isEx =
        Model.WorkingConditionNames != null &&
        Model.WorkingConditionNames.Any(x =>
        x.Equals("Patlayƒ±cƒ± Ortamlar", StringComparison.OrdinalIgnoreCase) ||
        x.Equals("Patlayƒ±cƒ± ve Kimyasal Ortamlar", StringComparison.OrdinalIgnoreCase)
        );
    }

    @{
        string selectedVoltage = ViewBag.SelectedVoltage as string;
        string voltageCode = string.Empty;

        if (!string.IsNullOrEmpty(selectedVoltage))
        {
            if (selectedVoltage.StartsWith("3Ph"))
            {
                voltageCode = "(T)";
            }
            else if (selectedVoltage.StartsWith("1Ph"))
            {
                voltageCode = "(M)";
            }
        }

        bool showVoltageCode =
        !string.IsNullOrEmpty(voltageCode)
        && !(isEx && voltageCode == "(T)");
    }

    <h2 class="mb-4 d-flex align-items-center gap-2">

        @(Model.ProductModelCode)

        @if (!string.IsNullOrEmpty(Model.ProductTestName))
        {
            <span>@Model.ProductTestName</span>
        }

        <span id="workingPointLabel" style="display:none;"></span>

        @if (isEx)
        {
            <span>Ex</span>
        }

        @if (!string.IsNullOrEmpty(selectedVoltage) && showVoltageCode)
        {
            <span class="ms-1">@voltageCode</span>
        }

        <a href="@Url.Action("Index", "FanSelector")" class="btn btn-sm btn-outline-secondary">
            ‚Üê Ba≈üa D√∂n
        </a>

        <!-- üî• SAƒûA DAYALI PDF BUTONU -->
        <div class="pdf-btn-wrapper ms-auto">
            <button id="btnGeneratePdf" class="btn-pdf">
                üìÑ PDF Olu≈ütur
            </button>
        </div>



    </h2>







    <div class="card shadow-sm">
        <div class="card-body">

            <!-- =================== GRID START =================== -->
            <div class="row g-4">

                <!-- üîπ SOL S√úTUN (1/3) -->
                <div class="col-lg-4">

                    <!-- INPUT FORM -->
                    <form id="workingPointForm" class="row g-3">
                        <div class="it-btn-orange d-flex justify-content-center align-items-center">
                            <span>
                                <span class="text-1">ƒ∞STENEN KAPASƒ∞TE</span>
                                <span class="text-2">ƒ∞STENEN KAPASƒ∞TE</span>
                            </span>
                        </div>

                        <div>
                            <input type="number" name="Q" id="inputQ" placeholder="Debi (AirFlow)">
                        </div>

                        <div>
                            <input type="number" name="Pt" id="inputPt" placeholder="Basƒ±n√ß (Pt)">
                        </div>
                        <div class="order-button-payment mt-20">
                            <button class="it-btn-orange d-flex justify-content-center align-items-center"
                                type="submit">
                                <span>
                                    <span class="text-1">√áALI≈ûMA NOKTASI</span>
                                    <span class="text-2">√áALI≈ûMA NOKTASI</span>
                                </span>
                            </button>
                        </div>
                    </form>


                    <table class="table metric-table">
                        <tbody>
                            <tr>
                                <td class="label">Debi</td>
                                <td class="unit">Q</td>
                                <td class="value" id="meta-q">-</td>
                                <td class="unit">m¬≥/h</td>
                            </tr>
                            <tr>
                                <td class="label">Statik Basƒ±n√ß</td>
                                <td class="unit">Ps</td>
                                <td class="value" id="meta-ps">-</td>
                                <td class="unit">Pa</td>
                            </tr>
                            <tr>
                                <td class="label">Toplam Basƒ±n√ß</td>
                                <td class="unit">Pt</td>
                                <td class="value" id="meta-pt">-</td>
                                <td class="unit">Pa</td>
                            </tr>
                            <tr>
                                <td class="label">Dinamik Basƒ±n√ß</td>
                                <td class="unit">Pd</td>
                                <td class="value" id="meta-pd">-</td>
                                <td class="unit">Pa</td>
                            </tr>
                            <tr>
                                <td class="label">Hƒ±z</td>
                                <td class="unit">V</td>
                                <td class="value" id="meta-speed">-</td>
                                <td class="unit">m/s</td>
                            </tr>
                            <tr>
                                <td class="label">Akƒ±m</td>
                                <td class="unit">A</td>
                                <td class="value" id="meta-current">-</td>
                                <td class="unit">A</td>
                            </tr>
                            <tr>
                                <td class="label">Hava G√ºc√º</td>
                                <td class="unit">P</td>
                                <td class="value" id="meta-airpower">-</td>
                                <td class="unit">W</td>
                            </tr>
                            <tr>
                                <td class="label">Toplam Verim</td>
                                <td class="unit">Œ∑TOT</td>
                                <td class="value" id="meta-total-eff">-</td>
                                <td class="unit">%</td>
                            </tr>
                            <tr>
                                <td class="label">Mekanik Verim</td>
                                <td class="unit">Œ∑MEC</td>
                                <td class="value" id="meta-mech-eff">-</td>
                                <td class="unit">%</td>
                            </tr>
                            <tr>
                                <td class="label">Ses Seviyesi</td>
                                <td class="unit">dBa(a)</td>
                                <td class="value" id="meta-db">-</td>
                                <td class="unit">dB(a)</td>
                            </tr>
                        </tbody>
                    </table>


                </div>

                <!-- üîπ SAƒû S√úTUN (2/3) -->
                <div class="col-lg-8">

                    <div class="chart-wrapper" style="height:480px;">
                        <canvas id="fanChart"></canvas>
                    </div>

                </div>


            </div>
            <!-- =================== GRID END =================== -->


            <!-- =================== ALT B√ñL√úMLER =================== -->

            <hr class="my-5">
            <!-- =================== 1. SATIR =================== -->
            <div class="row g-4 mt-3">
                <div class="col-lg-4">
                    <div class="mini-chart-card">
                        <div class="mini-chart-title">Static pressure [Pa]</div>
                        <div class="mini-chart-unit">Pa</div>
                        <div class="mini-chart-canvas">
                            <canvas id="chart-ps"></canvas>
                        </div>
                    </div>
                </div>

                <div class="col-lg-4">
                    <div class="mini-chart-card">
                        <div class="mini-chart-title">Dynamic pressure [Pa]</div>
                        <div class="mini-chart-unit">Pa</div>
                        <div class="mini-chart-canvas">
                            <canvas id="chart-pd"></canvas>
                        </div>
                    </div>
                </div>

                <div class="col-lg-4">
                    <div class="mini-chart-card">
                        <div class="mini-chart-title">Total pressure [Pa]</div>
                        <div class="mini-chart-unit">Pa</div>
                        <div class="mini-chart-canvas">
                            <canvas id="chart-pt"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- =================== 2. SATIR =================== -->
            <div class="row g-4 mt-2">
                <div class="col-lg-4">
                    <div class="mini-chart-card">
                        <div class="mini-chart-title">Rotational speed [1/min]</div>
                        <div class="mini-chart-unit">rpm</div>
                        <div class="mini-chart-canvas">
                            <canvas id="chart-speed"></canvas>
                        </div>
                    </div>
                </div>

                <div class="col-lg-4">
                    <div class="mini-chart-card">
                        <div class="mini-chart-title">Current [A]</div>
                        <div class="mini-chart-unit">A</div>
                        <div class="mini-chart-canvas">
                            <canvas id="chart-current"></canvas>
                        </div>
                    </div>
                </div>

                <div class="col-lg-4">
                    <div class="mini-chart-card">
                        <div class="mini-chart-title">Power [W]</div>
                        <div class="mini-chart-unit">W</div>
                        <div class="mini-chart-canvas">
                            <canvas id="chart-power"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- =================== 3. SATIR =================== -->
            <div class="row g-4 mt-2">
                <div class="col-lg-4">
                    <div class="mini-chart-card">
                        <div class="mini-chart-title">Sound level [dB(A)]</div>
                        <div class="mini-chart-unit">dB(A)</div>
                        <div class="mini-chart-canvas">
                            <canvas id="chart-db"></canvas>

                        </div>
                    </div>
                </div>

                <div class="col-lg-4">
                    <div class="mini-chart-card">
                        <div class="mini-chart-title">Static efficiency [%]</div>
                        <div class="mini-chart-unit">%</div>
                        <div class="mini-chart-canvas">
                            <canvas id="chart-eff-static"></canvas>
                        </div>
                    </div>
                </div>

                <div class="col-lg-4">
                    <div class="mini-chart-card">
                        <div class="mini-chart-title">Total efficiency [%]</div>
                        <div class="mini-chart-unit">%</div>
                        <div class="mini-chart-canvas">
                            <canvas id="chart-eff-total"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row g-4 mt-3">

                <div class="row g-4 mt-4 align-items-center">

                    <!-- üîπ SOL S√úTUN: G√ñRSEL (SAƒûA DAYALI) -->
                    <div class="col-lg-6 d-flex justify-content-end">
                        <div class="product-main-image">
                            <img src="https://admin.gurvent.firatramazano.com/@Model.Image1Path" alt="@Model.Name"
                                class="img-fluid" style="height:500px; object-fit:contain;" />
                        </div>
                    </div>

                    <!-- üîπ SAƒû S√úTUN: METƒ∞N (SOLA DAYALI) -->
                    <div class="col-lg-6 text-start">

                        <h4 class="fw-bold mb-2" style="color: #296299;">
                            @Model.Code
                        </h4>

                        <h5 class="mb-3" style="color: #296299;">@Model.Name</h5>

                        <p class="text-muted mb-4">
                            @Model.Description
                        </p>

                    </div>

                </div>
                <div class="row g-4 mt-5 align-items-center">

                    @if (Model.Accessories != null && Model.Accessories.Any())
                    {
                        <hr class="my-5" />

                        <h4 class="mb-3" style="color:#296299;">Aksesuarlar</h4>
                        <div class="accessory-table-wrapper">
                            <table class="accessory-table">
                                <thead>
                                    <tr>
                                        <th></th>
                                        <th>Model</th>
                                        <th>Type</th>
                                        <th>Article number</th>
                                    </tr>
                                </thead>
                                <tbody>

                                    <!-- ROW -->
                                    @foreach (GurventVantilator.Application.DTOs.ProductAccessoryDto item in
                                                                    Model.Accessories)
                                    {
                                        <tr class="accessory-row">
                                            <td><img src="@item.ImagePath" /></td>
                                            <td>@item.AccessoryName</td>
                                            <td>@item.Type</td>
                                            <td>@item.ArticleNumber</td>
                                        </tr>
                                    }


                                </tbody>
                            </table>
                        </div>

                    }
                </div>
                <div class="row g-4 mt-4 align-items-center">

                    <!-- üîπ SOL S√úTUN: G√ñRSEL (SAƒûA DAYALI) -->
                    <div class="col-lg-12 d-flex">
                        <div class="product-main-image">
                            <img src="https://admin.gurvent.firatramazano.com/@Model.ScaleImagePath" alt="@Model.Name"
                                class="img-fluid" />
                        </div>
                    </div>

                </div>
            </div>

        </div>
    </div>

</div>

<!-- GLOBAL LOADING OVERLAY -->
<div id="globalLoader" class="global-loader">
    <div class="loader-box">
        <div class="spinner"></div>
        <div class="loader-text">L√ºtfen bekleyiniz...</div>
    </div>
</div>


@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        window.initialWorkingPoint = {
            q: @(ViewBag.InitialQ != null
                            ? ViewBag.InitialQ.ToString(System.Globalization.CultureInfo.InvariantCulture)
                            : "null"),
            pt: @(ViewBag.InitialPt != null
                            ? ViewBag.InitialPt.ToString(System.Globalization.CultureInfo.InvariantCulture)
                            : "null")
                                                                };
    </script>


    <script>
        window.performanceData = {
            productId: @productId,
            initialWorkingPoint: window.initialWorkingPoint,
            speedControl: "@ViewBag.SpeedControl",
            selectedVoltage: "@ViewBag.SelectedVoltage"
        };
    </script>

    <script src="~/js/performance-script.js" asp-append-version="true"></script>
}